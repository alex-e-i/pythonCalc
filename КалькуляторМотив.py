import streamlit as st
import matplotlib.pyplot as plt
import numpy as np
from math import pi
import pandas as pd
import datetime

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
st.set_page_config(page_title="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–æ—Ç–∏–≤–∞—Ü–∏–∏ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤", layout="wide")
st.title("üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–æ—Ç–∏–≤–∞—Ü–∏–∏ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤ –∫ –£–¢–ó")

# –û–ø–∏—Å–∞–Ω–∏–µ
st.markdown("""
–≠—Ç–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–æ–¥–µ–ª–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤ –∫ —É—á–µ–±–Ω–æ-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–º –∑–∞–Ω—è—Ç–∏—è–º 
–Ω–∞ —ç—Ç–∞–ø–µ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π.
""")

# –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–¥–µ–ª–∏
components = [
    "–¶–∏—Ñ—Ä–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
    "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å",
    "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞",
    "–í–Ω–µ—à–Ω–∏–µ –∞–≥–µ–Ω—Ç—ã",
    "–ë–∞–∑–æ–≤—ã–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏",
    "–ù–∞–≤—ã–∫–∏ —Å–∞–º–æ—Ä–µ–≥—É–ª—è—Ü–∏–∏",
    "–û—Ü–µ–Ω–∫–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è"
]

# –í–µ—Å–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
weights = {
    "–¶–∏—Ñ—Ä–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏": 0.15,
    "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å": 0.1,
    "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞": 0.15,
    "–í–Ω–µ—à–Ω–∏–µ –∞–≥–µ–Ω—Ç—ã": 0.15,
    "–ë–∞–∑–æ–≤—ã–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏": 0.15,
    "–ù–∞–≤—ã–∫–∏ —Å–∞–º–æ—Ä–µ–≥—É–ª—è—Ü–∏–∏": 0.15,
    "–û—Ü–µ–Ω–∫–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è": 0.2
}

# –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö
st.sidebar.header("üéõÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç 0 –¥–æ 10")

values = {}
for comp in components:
    values[comp] = st.sidebar.slider(comp, min_value=0.0, max_value=10.0, value=5.0, step=0.1)

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –º–æ—Ç–∏–≤–∞—Ü–∏–∏
motivation_score = sum(weights[comp] * values[comp] for comp in components)

# –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
st.subheader("üìä –†–µ–∑—É–ª—å—Ç–∞—Ç")
st.metric(label="–£—Ä–æ–≤–µ–Ω—å –º–æ—Ç–∏–≤–∞—Ü–∏–∏", value=f"{motivation_score:.2f} / 10")

# –†–∞–¥–∞—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
def plot_radar(data):
    labels = list(data.keys())
    stats = list(data.values())

    angles = [n / float(len(labels)) * 2 * pi for n in range(len(labels))]
    stats += stats[:1]
    angles += angles[:1]

    fig, ax = plt.subplots(figsize=(6, 6), subplot_kw=dict(polar=True))
    ax.fill(angles, stats, color='skyblue', alpha=0.4)
    ax.plot(angles, stats, color='blue', linewidth=2)

    ax.set_xticks(angles[:-1])
    ax.set_xticklabels(labels)
    ax.yaxis.set_ticklabels([])

    plt.title("–ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞", size=20, pad=30)
    return fig

fig = plot_radar(values)
st.pyplot(fig)

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
st.sidebar.markdown("---")
st.sidebar.subheader("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ")

if st.sidebar.button("–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ CSV"):
    timestamp = datetime.datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
    data_to_save = {
        "–ü–∞—Ä–∞–º–µ—Ç—Ä": components + ["–û–±—â–∏–π —É—Ä–æ–≤–µ–Ω—å –º–æ—Ç–∏–≤–∞—Ü–∏–∏"],
        "–ó–Ω–∞—á–µ–Ω–∏–µ": list(values.values()) + [motivation_score]
    }
    df = pd.DataFrame(data_to_save)
    csv = df.to_csv(index=False)
    st.sidebar.download_button(
        label="üì• –°–∫–∞—á–∞—Ç—å CSV",
        data=csv,
        file_name=f"motivation_profile_{timestamp}.csv",
        mime="text/csv"
    )

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏
with st.expander("‚ÑπÔ∏è –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –º–æ–¥–µ–ª–∏"):
    st.markdown("""
    –ú–æ–¥–µ–ª—å –≤–∫–ª—é—á–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∫–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:
    
    - **–¶–∏—Ñ—Ä–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**: –¥–Ω–µ–≤–Ω–∏–∫–∏, –¥–∞—Ç—á–∏–∫–∏, –≤–∏–¥–µ–æ, –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
    - **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å**
    - **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: –º–æ—Ç–∏–≤–∞—Ü–∏—è, —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –£–¢–ü, —Å–æ—Ü–∏–æ–º–µ—Ç—Ä–∏—è –∏ –¥—Ä.
    - **–ù–∞–≤—ã–∫–∏ —Å–∞–º–æ—Ä–µ–≥—É–ª—è—Ü–∏–∏**: —Ü–µ–ª–µ–ø–æ–ª–∞–≥–∞–Ω–∏–µ, —Å–∞–º–æ–∞–Ω–∞–ª–∏–∑, –≤–æ–ª–µ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
    - **–ë–∞–∑–æ–≤—ã–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏**: –∞–≤—Ç–æ–Ω–æ–º–∏—è, –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å
    - **–í–Ω–µ—à–Ω–∏–µ –∞–≥–µ–Ω—Ç—ã**: —Ç—Ä–µ–Ω–µ—Ä, —Ä–æ–¥–∏—Ç–µ–ª–∏, –≥—Ä—É–ø–ø–æ–≤–æ–π –∫–ª–∏–º–∞—Ç, —Å—Ç–∏–º—É–ª—ã
    - **–û—Ü–µ–Ω–∫–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è**: –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö, –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
    - **–≠—Ç–∞–ø—ã —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏**: –≤–æ–≤–ª–µ—á–µ–Ω–∏–µ ‚Üí —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è ‚Üí —É–≥–ª—É–±–ª–µ–Ω–∏–µ
    """)

# –ü–æ–¥–≤–∞–ª
st.markdown("---")
st.markdown("üéì –ú–æ–¥–µ–ª—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤ –∫ –£–¢–ó –Ω–∞ —ç—Ç–∞–ø–µ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏")
